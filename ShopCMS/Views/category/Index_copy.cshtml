@model Domain.Category
@using CoreLib.Infrastructure
@using ahmadi.Infrastructure.Helper
@using CoreLib.Infrastructure
@using PagedList.Mvc;

@{var Meta = ViewBag.Meta as ahmadi.ViewModels.Home.Meta;
    var sliders = ViewBag.Sliders as IEnumerable<Domain.Slider>;
    var setting = ViewBag.setting as Domain.Setting;
    int i = 1;
    var ads = ViewBag.Ads as IEnumerable<Domain.Adveresting>;
    int SumSize = 0;
    var latestContent = ViewBag.LatestContent as PagedList.IPagedList<Domain.Content>;

}

@section Header{
    <link href="~/Content/Base/Css/view/Category.css" rel="stylesheet" />
}

@section Meta{
    @Html.Partial("_Meta", Meta)
}


<section class="categories spad" id="Category">
    <div class="container ads">
        <div class="row">
            @{ SumSize = 0;}
            @foreach (var item in ads.Where(x => x.Position == 1))
            {
                SumSize += CoreLib.Infrastructure.CommonFunctions.GetSizeColumn(item.AdverestingSizeId);
                <div class="Adveresting Position-@item.Position Size-@item.AdverestingSizeId @(SumSize==12?"lastbox":"")">
                    <a href="@item.Link" title="@item.Title">
                        <div class="categories__item set-bg" data-setbg="@Html.DisplayattachmentUrl(item.attachment.FileName)" style="background-image: url(&quot;@Html.DisplayattachmentUrl(item.attachment.FileName)&quot;);">
                            <div class="categories__hover__text">
                                <h5>@item.Title</h5>
                            </div>
                        </div>
                    </a>
                </div>
            }

        </div>
    </div>
    <div class="categories__post">
        <div class="container">
            <div class="row">
                @if (sliders != null)
                {
                    if (sliders.Any())
                    {
                        i = 0;
                        <div class="col-lg-12">

                            @foreach (var slider in sliders)
                            {
                                @Html.Partial("_BootStrapSlideShowCaptionBlog", slider, new ViewDataDictionary { { "Index", i.ToString() }, { "staticUrl", Meta.StaticContentUrl } })
                                i++;
                            }

                        </div>
                    }
                }

                <div class="col-md-12" id="h1">
                    <h1>@Model.Title</h1>
                </div>
                <div class="col-lg-12 col-md-12">


                    <ol class="breadcrumb" itemscope="" itemtype="http://schema.org/BreadcrumbList">
                        <li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem" class="breadcrumb-item"><a itemprop="item" href="/"><span itemprop="name"> صفحه اصلی</span></a><meta itemprop="position" content="0"></li>
                        @Html.Raw(ViewBag.breadcrumbCat)
                    </ol>



                    <div class="container ads">
                        <div class="row">

                            @{ SumSize = 0;}
                            @foreach (var item in ads.Where(x => x.Position == 2))
                            {
                                SumSize += CoreLib.Infrastructure.CommonFunctions.GetSizeColumn(item.AdverestingSizeId);
                                <div class="Adveresting Position-@item.Position Size-@item.AdverestingSizeId @(SumSize==12?"lastbox":"")">
                                    <a href="@item.Link" title="@item.Title">
                                        <div class="categories__item set-bg" data-setbg="@Html.DisplayattachmentUrl(item.attachment.FileName)" style="background-image: url(&quot;@Html.DisplayattachmentUrl(item.attachment.FileName)&quot;);">
                                            <div class="categories__hover__text">
                                                <h5>@item.Title</h5>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            }
                        </div>
                    </div>

                    <div class="row" id="LatestContents">
                        @foreach (var item in latestContent)
                        {
                            <div class="categories__post__item col-md-4 ">
                                <div class="item">
                                    <img src="@Html.DisplayattachmentUrl(item.BlogCover.HasValue?item.Blogattachment.FileName:item.Cover.HasValue? item.attachment.FileName:"default-thumbnail.jpg","SM",true)" alt="@item.Title" class="img-responsive" />

                                    <div class="categories__post__item__text">
                                        <h2>

                                            <a href="@Url.Action("Index","Content",new {id=item.Id,title=CommonFunctions.NormalizeAddress(item.PageAddress) })">
                                                @item.Title
                                            </a>
                                        </h2>
                                        <ul class="post__widget">
                                            @*<li>نویسنده : <span>@item.User.FirstName @item.User.LastName </span></li>*@
                                            <li> زمان مطالعه : <span> @item.ReadMinuts  دقیقه </span> </li>
                                        </ul>
                                        <p class="abstract">
                                            @item.Abstract
                                        </p>
                                        <p class="text-center">

                                            <a class="btn btn-info more-post" href="@Url.Action("Index","Content",new {id=item.Id,title=CommonFunctions.NormalizeAddress(item.PageAddress) })">
                                                ادامه مطلب
                                            </a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        }

                    </div>
                    @if (latestContent.PageCount > 1)
                    {

                        <div id="Pager" class="categories__pagination">
                            @Html.PagedListPager(latestContent, page => Url.Action(null, "Category", new { id = Model.Id, title = CommonFunctions.NormalizeAddress(Model.Title), page }))
                            <p>
                                <strong>
                                    صفحه  @(latestContent.PageCount < latestContent.PageNumber ? 0 : latestContent.PageNumber) از @latestContent.PageCount از میانِ @latestContent.TotalItemCount @Model.Title
                                </strong>
                            </p>
                        </div>
                    }
                </div>
                
            </div>
            <br /><br />
            <div class="ads">
                <div class="row">

                    @{ SumSize = 0;}
                    @foreach (var item in ads.Where(x=>x.Position==4))
                    {
                        SumSize += CoreLib.Infrastructure.CommonFunctions.GetSizeColumn(item.AdverestingSizeId);
                        <div class="Adveresting Position-@item.Position Size-@item.AdverestingSizeId @(SumSize==12?"lastbox":"")">
                            <a href="@item.Link" title="@item.Title">
                                <div class="categories__item set-bg" data-setbg="@Html.DisplayattachmentUrl(item.attachment.FileName)" style="background-image: url(&quot;@Html.DisplayattachmentUrl(item.attachment.FileName)&quot;);">
                                    <div class="categories__hover__text">
                                        <h5>@item.Title</h5>
                                    </div>
                                </div>
                            </a>
                        </div>
                    }
                </div>
            </div>

        </div>
    </div>
</section>

@section Scripts{


}
