@model Domain.Content

@using CoreLib.Infrastructure.DateTime
@using ahmadi.Infrastructure.Helper
@using CoreLib.Infrastructure
@using CoreLib.ViewModel.Xml

@{
    var nextContent = ViewBag.nextContent as Domain.Content;
    var prevContent = ViewBag.prevContent as Domain.Content;

    var Meta = ViewBag.Meta as ahmadi.ViewModels.Home.Meta;
    var sliders = ViewBag.Sliders as List<Domain.Slider>;

    var ads = ViewBag.Ads as IEnumerable<Domain.Adveresting>;
    XMLReader readXML = new XMLReader(Meta.StaticContentUrl);
    var ContentType = readXML.DetailOfXContentType(Model.ContentTypeId);
    string currentUrl = "https://" + HttpContext.Current.Request.Url.Host + "/content/" + Model.Id + "/" + CommonFunctions.NormalizeAddress(Model.PageAddress);
    int k = 0;
}

@section Meta{
    @Html.Partial("_Meta", Meta)

}


@section Header{
    <link href="~/Content/Base/Css/glyphicon.css" rel="stylesheet" />
    <link href="~/Content/Base/Css/star-rating.min.css" rel="stylesheet" />
    <link href="~/Content/Base/Css/prettyPhoto.css" rel="stylesheet" />
    <link href="~/Content/Base/Css/view/Content.css?v=1.2.4" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
}


<section class="single-post spad">

    <div class="container">
        <div class="row d-flex justify-content-center">
            <div class="col-md-12" id="Top-content">
                <ol class="breadcrumb" itemscope="" itemtype="http://schema.org/BreadcrumbList">
                    <li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem" class="breadcrumb-item"><a itemprop="item" href="/"><span itemprop="name"> صفحه اصلی</span></a><meta itemprop="position" content="0"></li>
                    @Html.Raw(ViewBag.breadcrumbCat)
                </ol>

                <h1>@Model.Title</h1>
                <div class="single-post__title__text">

                    <ul class="widget">
                        @*<li>نویسنده : <span>@Model.User.FirstName @Model.User.LastName </span></li>*@
                        <li><span class="fa fa-calendar"></span>@CoreLib.Infrastructure.DateTime.DateTimeConverter.ChangeMiladiToLongShamsi(Model.InsertDate)</li>
                        @if (Model.UpdateDate.HasValue)
                        {
                            <li><span class="fa fa-calendar"></span>بروزرسانی: @CoreLib.Infrastructure.DateTime.DateTimeConverter.ChangeMiladiToLongShamsi(Model.UpdateDate.Value)</li>
                        }
                        <li>
                            <span class="fa fa-comment"></span>
                            @if (Model.Comments.Count > 0)
                            {
                                <span>@Model.Comments.Count</span> <span> نظر </span>
                            }
                            else
                            {
                                <span> بدون نظر </span>
                            }
                        </li>
                        <li><span class="fa fa-bell"></span> <span> @Model.ReadMinuts  دقیقه </span> </li>
                        <li><span class="fa fa-user"></span> <span> @Model.Visits </span> </li>
                    </ul>

                </div>

                <div id="Rate" data-ContentId="@Model.Id">
                    <form>
                        <input type="text" id="ContentRate" class="rating-loading" />
                    </form>
                    @if (Model.ContentRating != null)
                    {
                        <div id="RateResult" itemscope="" itemtype="http://schema.org/Product">
                            <span itemprop="name">@Model.Title</span>
                            <div itemprop="aggregateRating" itemscope="" itemtype="http://schema.org/AggregateRating">
                                <span itemprop="ratingValue">@Model.ContentRating.AverageRating</span> از 5 بوسیله <span itemprop="reviewCount">@Model.ContentRating.TotalRaters</span> رای
                            </div>
                        </div>
                    }
                </div>

            </div>
            <div class="col-lg-8" id="Data-content">

                <div class="single-post__recipe__details">
                    <div class="image-m">
                        @if (Model.Cover.HasValue)
                        {
                            <img src="@Html.DisplayattachmentUrl(Model.Cover.HasValue?Model.attachment.FileName:"default-thumbnail.jpg","SM",true)" alt="@Model.Title" class="img-responsive img-thumbnail" />

                        }
                        else
                        {
                            <img src="default-thumbnail.jpg" alt="@Model.Title" class="img-responsive img-thumbnail" />
                        }
                    </div>
                    <div class="single-post__recipe__details__indegradients">
                        @Html.Raw(Model.Data)
                    </div>

                </div>


                @if (Model.Sources.Any())
                {
                    <div class="single-post__tags">
                        <ul>
                            <li><span class="PagecontentSourceText">منبع : </span></li>
                            @foreach (var item in Model.Sources)
                            {
                                <li><a href="@item.Link" target="_blank"><span class="fa fa-link"></span> @item.Title </a></li>
                            }
                        </ul>
                    </div>


                }


                <div class="single-post__tags">
                    @foreach (var item in Model.Tags)
                    {

                        <a href="@Url.Action("Index","Tag",new {id=item.Id,title=CommonFunctions.NormalizeAddress(item.TagName) })">@item.TagName</a>
                    }
                </div>
                <div class="single-post__social__item">
                    <ul>
                        <li><a href="whatsapp://send?text=@Model.Title @currentUrl"><i class="fa fa-whatsapp"></i></a></li>
                        <li><a href="tg://msg_url?url=@currentUrl"><i class="fa fa-send"></i></a></li>
                        @*<li><a href="https://www.linkedin.com/shareArticle?mini=true&url=@currentUrl"><i class="fa fa-linkedin"></i></a></li>*@
                        @*<li><a href="https://www.facebook.com/sharer/sharer.php?u=@currentUrl"><i class="fa fa-facebook"></i></a></li>*@
                        <li><a href="http://twitter.com/intent/tweet?text=@Model.Title&url=@currentUrl"><i class="fa fa-twitter"></i></a></li>
                        <li><a href="https://plus.google.com/share?url=@currentUrl"><i class="fa fa-google"></i></a></li>
                    </ul>
                </div>









                @*<div class="single-post__author__profile">
                <div class="single-post__author__profile__pic">
                    @if (Model.User.Avatar.HasValue)
                    {
                        @Html.Displayattachment(Model.User.Avatar.Value, "SM", htmlAttributes: new { @class = "img-responsive round-img" })
                    }
                    else
                    {
                        if (Model.User.Gender == true)
                        {
                            <img class="round-img" src="~/Content/Default/images/man-avatar.jpg" />
                        }
                        else
                        {
                            <img class="round-img" src="~/Content/Default/images/woman-avatar.gif" />
                        }
                    }
                </div>


                <div class="single-post__author__profile__text">
                    <h4>@Model.User.FirstName @Model.User.LastName </h4>
                    <p>
                        @Model.User.About
                    </p>
                </div>
            </div>*@

                @*<div class="single-post__leave__comment">
                                <div class="widget__title">
                                    <h4>نظر خود را بنویسید</h4>
                                </div>
                                <form action="#">
                                    <div class="input-list">
                                        <input type="text" placeholder="Name">
                                        <input type="text" placeholder="Email">
                                        <input type="text" placeholder="Website">
                                    </div>
            <textarea placeholder="Message"></textarea>
                                    <button type="submit" class="site-btn">Submit</button>
                                </form>
                            </div>*@
            </div>
            <div class="col-md-4" id="Related-Content">
                <div class="mobile-L">
                    @if (Model.Cover.HasValue)
                    {
                        <img src="@Html.DisplayattachmentUrl(Model.Cover.HasValue?Model.attachment.FileName:"default-thumbnail.jpg","SM",true)" alt="@Model.Title" class="img-responsive img-thumbnail" />

                    }
                    else
                    {
                        <img src="default-thumbnail.jpg" alt="@Model.Title" class="img-responsive img-thumbnail" />
                    }
                </div>

                <div id="RelatedContents">

                    <h2><span>مطالب مرتبط</span></h2>
                    @foreach (var item in ViewBag.contentTypes as IQueryable<ahmadi.ViewModels.Content.ContentTypeViewModel>
)
                    {
                        if (item.Contents.Any())
                        {
                            <div class="contentLefSide PagecontentRelated">
                                @foreach (var contentItem in item.Contents)
                                {

                                    <div class="contentLefSideContent">
                                        @*<div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                        <a href="@Url.Action("Index", "content", new { id = contentItem.Id, title = CommonFunctions.NormalizeAddress(contentItem.Title) })">
                                            @if (contentItem.Cover.HasValue)
                                            {
                                                @Html.Displayattachment(contentItem.attachment.FileName, contentItem.Title, "XS", true, new { @class = "img-responsive" })
                                            }
                                            else
                                            {
                                                <img src="~/Content/Default/images/default-thumbnail.jpg" class="img-responsive" />

                                            }
                                        </a>

                                    </div>*@
                                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">

                                            <h5><a href="@Url.Action("Index", "content", new { id = contentItem.Id, title = CommonFunctions.NormalizeAddress(contentItem.Title) })">@contentItem.Title</a></h5>
                                            @*<p class="contentLefSideDate">@CoreLib.Infrastructure.DateTime.DateTimeConverter.ChangeMiladiToLongShamsi(contentItem.InsertDate)</p>*@
                                        </div>
                                        <div class="clearfix"></div>

                                    </div>
                                }
                                @*<a class="more-Content" href="@Url.Action("Index", "ContentType", new { id = item.Id, title = CoreLib.Infrastructure.CommonFunctions.NormalizeAddress(item.Name) })">بیشتر >></a>*@
                            </div>
                        }
                    }
                </div>

                @if (Model.OtherImages.Any())
                {
                    <div>
                        <div id="OtherImages">
                            <h4><span>تصاویر بیشتر</span></h4>

                            <section">


                                @foreach (var item in Model.OtherImages.OrderBy(x => x.DisplaySort))
                                {
                                    <div class="js-product-box-container swiper-slide">
                                        <a href="@Html.DisplayattachmentUrl(item.attachment.FileName)">
                                            @Html.Displayattachment(item.attachment.FileName, item.Title, "MD", true, new { @class = "img-responsive img-thumbnail" })
                                        </a>
                                    </div>
                                    <br />
                                }

                            </section">
                        </div>
                    </div>

                }
            </div>

            <div class="col-md-12" id="Content-Comments">
                <div class="single-post__comment">
                    @if (Model.Comments.Count > 0)
                    {
                        <div class="widget__title">
                            <h4>@Model.Comments.Count نظر</h4>
                        </div>
                    }

                    @if (!Model.HasContact)
                    {
                        <div id="comments">

                            @foreach (var item in Model.Comments.Where(x => x.IsActive == true && x.ParrentId == null))
                            {
                                <div class="single-post__comment__item" id="Comment_@(item.Id)">
                                    <div class="single-post__comment__item__pic">
                                        <img class="img-responsive" style="width: 64px; height: 64px;" src="~/Content/Default/images/man-avatar.jpg">
                                    </div>
                                    <div class="single-post__comment__item__text">
                                        <h5 class="comment-classic-name">@item.FullName</h5>
                                        <span>@DateTimeConverter.ChangeMiladiToLongShamsi(item.InsertDate) - @item.InsertDate.ToString("HH:mm")</span>

                                        <p>@item.Message</p>
                                        <ul>
                                            <li><span href="#"><span>@item.PositiveRating</span><i data-id="@item.Id" class="fa fa-plus-square"></i></span></li>
                                            <li><span href="#"><span>@item.NegativeRating</span><i data-id="@item.Id" class="fa fa-minus-square"></i></span></li>
                                            <li><span onclick="NestedComment(@item.Id)" href="#"><i class="fa fa-share-square-o"></i></span></li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="comment-classic-group" id="Comment_@(item.Id)">
                                    <!-- Comment Classic-->


                                    @foreach (var item2 in item.ChildComment.Where(x => x.IsActive == true))
                                    {
                                        <div class="single-post__comment__item single-post__comment__item--reply">
                                            <div class="single-post__comment__item__pic">
                                                <img class="comment-classic-image img-responsive" style="width: 64px; height: 64px;" src="~/Content/Default/images/man-avatar.jpg">
                                            </div>
                                            <div class="single-post__comment__item__text">
                                                <h5>@item2.FullName</h5>
                                                <span>@DateTimeConverter.ChangeMiladiToLongShamsi(item2.InsertDate) - @item2.InsertDate.ToString("HH:mm")</span>
                                                <p>@item2.Message</p>
                                                <ul>
                                                    <li><span href="#"><span>@item2.PositiveRating</span><i data-id="@item.Id" class="fa fa-plus-square"></i></span></li>
                                                    <li><span href="#"><span>@item2.NegativeRating</span><i data-id="@item.Id" class="fa fa-minus-square"></i></span></li>
                                                </ul>
                                            </div>

                                        </div>



                                    }


                                </div>



                            }



                        </div>
                        @Html.Partial("_Comment", new Domain.Comment(Model.Id))
                    }
                    else
                    {
                        @Html.Partial("_ContactUsForm", new Domain.ContactUs(Model.Id))


                    }



                </div>
            </div>
        </div>
    </div>
</section>





@section Scripts{
    <script src="~/Content/Base/Scripts/Rating/star-rating.min.js"></script>
    <script src="~/Content/Base/Scripts/PrettyImage/jquery.prettyPhoto.js"></script>
    <script src="https://unpkg.com/swiper/swiper-bundle.js"></script>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script>

        var slider2 =
            new Swiper('.sliderOther', {
                zoom: true,
                spaceBetween: 5,
                slidesPerView: 2,

                // Navigation arrows
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },

                // And if we need scrollbar
                scrollbar: {
                    el: '.swiper-scrollbar',
                }
            });




    </script>

    <script src="~/Content/Base/Scripts/View/Content.js"></script>

}
