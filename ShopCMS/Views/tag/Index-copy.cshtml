@model Domain.Tag
@using CoreLib.Infrastructure
@using ahmadi.Infrastructure.Helper
@using CoreLib.Infrastructure
@{var Meta = ViewBag.Meta as ahmadi.ViewModels.Home.Meta;
    var sliders = ViewBag.Sliders as IEnumerable<Domain.Slider>;
    var setting = ViewBag.setting as Domain.Setting;
    var MostvisitContents = ViewBag.MostVisitsContent as IEnumerable<Domain.Content>;

    var ads = ViewBag.Ads as IEnumerable<Domain.Adveresting>;
}

@section Meta{
    @Html.Partial("_Meta", Meta)
}

@section Header{
    <link href="~/Content/Base/Css/view/tag.css" rel="stylesheet" />
}



<section class="categories spad" id="ContentType">

    <div class="body-content outer-top-xs">
        <div class="container">
            @if (ads.Where(x => x.Position == 1).Any())
            {
                <div class="content">
                    <div class="clearfix filters-container m-t-20">
                        <div class="row adv-row">

                            @if (ads.Where(x => x.Position == 1).Any())
                            {
                                int SumSize = 0;
                                <div class="adv-box">
                                    @foreach (var Adveresting in ads.Where(x => x.Position == 1).OrderBy(x => x.DisplaySort))
                                    {
                                        SumSize += CoreLib.Infrastructure.CommonFunctions.GetSizeColumn(Adveresting.AdverestingSizeId);

                                        <div class="adv-image Adveresting Position-@Adveresting.Position Size-@Adveresting.AdverestingSizeId @(SumSize == 12 ? " lastbox":"" )">
                                            <a href="@(Adveresting.TypeLink == false ? Adveresting.Link : " Ads/" + Adveresting.Id)" title="@Adveresting.Title">
                                                @Html.Displayattachment(Adveresting.attachment.FileName, Adveresting.Title, "LG", true, new { @Class = "img-responsive" })
                                            </a>
                                        </div>
                                        if (SumSize == 12)
                                        {
                                            SumSize = 0;
                                            <div class="clearfix"></div>
                                        }
                                    }
                                    <div class="clearfix"></div>
                                </div>
                            }
                        </div>
                    </div>

                </div>
                <br /><br />
            }

            <div class="row">
                <div class="col-md-9 col-sm-12 col-xs-12 sidebar">

                    <ol class="breadcrumb" itemscope="" itemtype="http://schema.org/BreadcrumbList">
                        <li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem" class="breadcrumb-item"><a itemprop="item" href="/"><span itemprop="name"> صفحه اصلی</span></a><meta itemprop="position" content="0"></li>
                        <li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem" class="breadcrumb-item"><a itemprop="item" href="@Url.Action(null, "tag", new { id = Model.Id, title = CommonFunctions.NormalizeAddress(Model.TagName) })"><span itemprop="name">@Model.TagName</span></a><meta itemprop="position" content="0"></li>
                    </ol>

                    <div class="detail-block">
                        <h1 class="content-titr">@Model.TagName</h1>
                        <p class="description">
                            لیست تمام محتواهای مرتبط با @Model.TagName
                        </p>

                        @if (sliders != null)
                        {
                            if (sliders.Any())
                            {
                                int j = 0;
                                foreach (var slider in ViewBag.Sliders as IEnumerable<Domain.Slider>)
                                {
                                    @Html.Partial("_BootStrapSlideShowCaption", slider, new ViewDataDictionary { { "Index", j.ToString() }, { "staticUrl", Meta.StaticContentUrl } })
                                    j++;
                                }
                            }
                        }

                        @if (ads.Where(x => x.Position == 2).Any())
                        {
                            <div class="content">
                                <div class="clearfix filters-container m-t-20">
                                    <div class="row adv-row">

                                        @if (ads.Where(x => x.Position == 2).Any())
                                        {
                                            int SumSize = 0;
                                            <div class="adv-box">
                                                @foreach (var Adveresting in ads.Where(x => x.Position == 2).OrderBy(x => x.DisplaySort))
                                                {
                                                    SumSize += CoreLib.Infrastructure.CommonFunctions.GetSizeColumn(Adveresting.AdverestingSizeId);

                                                    <div class="adv-image Adveresting Position-@Adveresting.Position Size-@Adveresting.AdverestingSizeId @(SumSize == 12 ? " lastbox":"" )">
                                                        <a href="@(Adveresting.TypeLink == false ? Adveresting.Link : " Ads/" + Adveresting.Id)" title="@Adveresting.Title">
                                                            @Html.Displayattachment(Adveresting.attachment.FileName, Adveresting.Title, "LG", true, new { @Class = "img-responsive" })
                                                        </a>
                                                    </div>
                                                    if (SumSize == 12)
                                                    {
                                                        SumSize = 0;
                                                        <div class="clearfix"></div>
                                                    }
                                                }
                                                <div class="clearfix"></div>
                                            </div>
                                        }
                                    </div>
                                </div>

                            </div>

                        }
                    </div>
                    <div class="detail-block m-t-20">

                        @{

                            var TagContent = ViewBag.LatestContent as IEnumerable<Domain.Content>;

                            int i = 1;

                            foreach (var item in ViewBag.ContentTypes as IEnumerable<CoreLib.ViewModel.Xml.XContentType>)
                            {
                                var latestContent = TagContent.Where(x => x.ContentTypeId == item.Id);
                                if (latestContent.Any())
                                {
                                    <div class="widget-header">
                                        <h4 class="widget-title">@Model.TagName در @item.Name</h4>

                                    </div>
                                    <hr />

                                    <div class="row" id="LatestContents">
                                        @foreach (var itemContent in latestContent)
                                        {

                                            <div class="categories__post__item col-md-4 ">
                                                <div class="item">
                                                    <img src="@Html.DisplayattachmentUrl(itemContent.BlogCover.HasValue?itemContent.Blogattachment.FileName:itemContent.Cover.HasValue? itemContent.attachment.FileName:"default-thumbnail.jpg","SM",true)" alt="@itemContent.Title" class="img-responsive" />
                                                    @* <div class="categories__post__item__pic set-bg" data-setbg="@Html.DisplayattachmentUrl(itemContent.BlogCover.HasValue?itemContent.Blogattachment.FileName:itemContent.Cover.HasValue? itemContent.attachment.FileName:"default-thumbnail.jpg")" style="background-image: url(&quot;@Html.DisplayattachmentUrl(itemContent.BlogCover.HasValue?itemContent.Blogattachment.FileName:itemContent.Cover.HasValue? itemContent.attachment.FileName:"default-thumbnail.jpg"))&quot;);">
                                                        <div class="post__meta">

                                                             <span>@CoreLib.Infrastructure.DateTime.DateTimeConverter.ChangeMiladiToShamsi(itemContent.InsertDate)</span>
                                                         </div>
                                                                        </div>*@
                                                    <div class="categories__post__item__text">
                                                        <h2>

                                                            <a href="@Url.Action("Index","Content",new {id=itemContent.Id,title=CommonFunctions.NormalizeAddress(itemContent.PageAddress) })">
                                                                @itemContent.Title
                                                            </a>
                                                        </h2>
                                                        <ul class="post__widget">
                                                            @*<li>نویسنده : <span>@itemContent.User.FirstName @itemContent.User.LastName </span></li>*@
                                                            @*<li> زمان مطالعه : <span> @itemContent.ReadMinuts  دقیقه </span> </li>*@
                                                        </ul>
                                                        <p class="abstract">
                                                            @itemContent.Abstract
                                                        </p>
                                                        <p class="text-center">

                                                            <a class="btn btn-info more-post" href="@Url.Action("Index","Content",new {id=itemContent.Id,title=CommonFunctions.NormalizeAddress(itemContent.PageAddress) })">
                                                                ادامه مطلب
                                                            </a>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>



                                        }
                                    </div>
                                    if (latestContent.Count() > 0)
                                    {

                                        <a href="@Url.Action("Index", "contentTag", new { contentTypeId = item.Id, id = Model.Id, title = CommonFunctions.NormalizeAddress(Model.TagName) })" class="btn btn-primary more-read-btn collapsed m-t-10">
                                            بیشتر
                                        </a>
                                    }


                                }
                            }

                        }




                    </div>




                </div>
                <div class="col-md-3 col-sm-12 col-xs-12">

                    @if (ads.Where(x => x.Position == 4).Any())
                    {
                        int SumSize = 0;
                        <div class="sidebar-widget m-t-10">
                            @foreach (var Adveresting in ads.Where(x => x.Position == 4))
                            {

                                SumSize += CoreLib.Infrastructure.CommonFunctions.GetSizeColumn(Adveresting.AdverestingSizeId);


                                <div class="home-banner Adveresting Position-@Adveresting.Position Size-@Adveresting.AdverestingSizeId @(SumSize == 12 ? " lastbox":"" )">
                                    <a href="@(Adveresting.TypeLink == false ? Adveresting.Link : " Ads/" + Adveresting.Id)" title="@Adveresting.Title">
                                        @Html.Displayattachment(Adveresting.attachment.FileName, Adveresting.Title, "LG", true, new { @Class = "img-responsive" })
                                    </a>
                                </div>
                                if (SumSize == 12)
                                {
                                    SumSize = 0;
                                    <div class="clearfix"></div>
                                }
                            }

                            <div class="clearfix"></div>

                        </div>

                    }



                    <div class="sidebar-widget wow fadeInUp m-t-10">

                        <div class="widget-header">
                            <h4 class="widget-title">پربازدیدترین مطالب</h4>
                            <hr>
                        </div>
                        <div class="sidebar-widget-body">
                            @foreach (var item in MostvisitContents)
                            {

                                <div class="col-sm-6 col-md-12  more-seen-article">

                                    <a href="@Url.Action("Index", "content", new { id = item.Id, title = CommonFunctions.NormalizeAddress(item.PageAddress) })">

                                        @if (item.Cover.HasValue)
                                        {
                                            @Html.DisplayattachmentCookieFree(Meta.StaticContentUrl, item.attachment.FileName, item.Title, "MD", true, new { @class = "img-responsive img-thumbnail" });
                                        }
                                        else
                                        {
                                            <img src="~/Content/images/default-thumbnail.jpg" class="img-responsive" />
                                        }
                                    </a>


                                    <h5>
                                        <a href="@Url.Action("Index","content", new { id = item.Id, title = CommonFunctions.NormalizeAddress(item.PageAddress) })">
                                            @item.Title
                                        </a>
                                    </h5>
                                    <div class="more-seen-sidebar">
                                        @*<p class="author">نویسنده : <span>@item.User.FirstName @item.User.LastName</span></p>*@
                                        <p class="date">تاریخ درج : <span>@CoreLib.Infrastructure.DateTime.DateTimeConverter.ChangeMiladiToLongShamsi(item.InsertDate)</span></p>
                                        <p class="seen-num"> تعداد بازدید : <span>@item.Visits</span></p>
                                    </div>
                                </div>
                            }
                            <div class="clearfix"></div>
                        </div>
                        <!-- /.sidebar-widget-body -->

                    </div>






                </div>
                <!-- /.sidebar -->
                <!-- /.col -->
            </div>
            <!-- /.row -->
            @if (ads.Where(x => x.Position == 3).Any())
            {
                <div class="content">
                    <div class="clearfix filters-container m-t-20">
                        <div class="row adv-row">

                            @if (ads.Where(x => x.Position == 3).Any())
                            {
                                int SumSize = 0;
                                <div class="adv-box">
                                    @foreach (var Adveresting in ads.Where(x => x.Position == 3).OrderBy(x => x.DisplaySort))
                                    {
                                        SumSize += CoreLib.Infrastructure.CommonFunctions.GetSizeColumn(Adveresting.AdverestingSizeId);

                                        <div class="adv-image Adveresting Position-@Adveresting.Position Size-@Adveresting.AdverestingSizeId @(SumSize == 12 ? " lastbox":"" )">
                                            <a href="@(Adveresting.TypeLink == false ? Adveresting.Link : " Ads/" + Adveresting.Id)" title="@Adveresting.Title">
                                                @Html.Displayattachment(Adveresting.attachment.FileName, Adveresting.Title, "LG", true, new { @Class = "img-responsive" })
                                            </a>
                                        </div>
                                        if (SumSize == 12)
                                        {
                                            SumSize = 0;
                                            <div class="clearfix"></div>
                                        }
                                    }
                                    <div class="clearfix"></div>
                                </div>
                            }
                        </div>
                    </div>

                </div>

            }



        </div>
        <!-- /.container -->

    </div>

</section>
